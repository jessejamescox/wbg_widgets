<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 100" width="100%" height="100%">
  <defs>
    <style>
      .duct { fill: #bdc3c7; stroke: #34495e; stroke-width: 2; }
      .filter-frame { fill: #7f8c8d; stroke: #2c3e50; stroke-width: 2; }
      .filter-media { fill: #ecf0f1; stroke: #95a5a6; stroke-width: 1; }
      .filter-dirty { fill: #8d6e63; }
      .status-good { fill: #27ae60; }
      .status-warning { fill: #f39c12; }
      .status-alarm { fill: #e74c3c; }
      .label-text { font-family: Arial, sans-serif; font-size: 9px; fill: #2c3e50; text-anchor: middle; font-weight: bold; }
    </style>
  </defs>

  <!-- Duct -->
  <rect x="10" y="10" width="60" height="80" class="duct" rx="2"/>

  <!-- Filter Frame -->
  <rect x="18" y="35" width="44" height="30" class="filter-frame" rx="2"/>

  <!-- Filter Media (pleated) -->
  <g id="filterMedia">
    <path d="M 20 37 L 22 39 L 20 41 L 22 43 L 20 45 L 22 47 L 20 49 L 22 51 L 20 53 L 22 55 L 20 57 L 22 59 L 20 61 L 22 63"
          class="filter-media" stroke-width="0.5"/>
    <path d="M 25 37 L 27 39 L 25 41 L 27 43 L 25 45 L 27 47 L 25 49 L 27 51 L 25 53 L 27 55 L 25 57 L 27 59 L 25 61 L 27 63"
          class="filter-media" stroke-width="0.5"/>
    <path d="M 30 37 L 32 39 L 30 41 L 32 43 L 30 45 L 32 47 L 30 49 L 32 51 L 30 53 L 32 55 L 30 57 L 32 59 L 30 61 L 32 63"
          class="filter-media" stroke-width="0.5"/>
    <path d="M 35 37 L 37 39 L 35 41 L 37 43 L 35 45 L 37 47 L 35 49 L 37 51 L 35 53 L 37 55 L 35 57 L 37 59 L 35 61 L 37 63"
          class="filter-media" stroke-width="0.5"/>
    <path d="M 40 37 L 42 39 L 40 41 L 42 43 L 40 45 L 42 47 L 40 49 L 42 51 L 40 53 L 42 55 L 40 57 L 42 59 L 40 61 L 42 63"
          class="filter-media" stroke-width="0.5"/>
    <path d="M 45 37 L 47 39 L 45 41 L 47 43 L 45 45 L 47 47 L 45 49 L 47 51 L 45 53 L 47 55 L 45 57 L 47 59 L 45 61 L 47 63"
          class="filter-media" stroke-width="0.5"/>
    <path d="M 50 37 L 52 39 L 50 41 L 52 43 L 50 45 L 52 47 L 50 49 L 52 51 L 50 53 L 52 55 L 50 57 L 52 59 L 50 61 L 52 63"
          class="filter-media" stroke-width="0.5"/>
    <path d="M 55 37 L 57 39 L 55 41 L 57 43 L 55 45 L 57 47 L 55 49 L 57 51 L 55 53 L 57 55 L 55 57 L 57 59 L 55 61 L 57 63"
          class="filter-media" stroke-width="0.5"/>
  </g>

  <!-- Status Indicator -->
  <circle id="statusIndicator" cx="40" cy="20" r="5" class="status-good"/>

  <!-- Pressure Drop Display -->
  <rect x="20" y="75" width="40" height="12" fill="#2c3e50" rx="2"/>
  <text id="pressureText" x="40" y="84" class="label-text" fill="#ffffff">0.5 in</text>

  <text x="40" y="96" class="label-text" font-size="7">PRESSURE DROP</text>

  <script><![CDATA[
//!export-start
let _pn_pressureDrop = 0.5;
let _pn_dpAlarmHigh = 1.0;
let _pn_dpWarning = 0.8;
let _pn_filterStatus = 0;
//!export-end

function init() {
  update();
}

    function update() {
const indicator = document.getElementById('statusIndicator');
const pressureText = document.getElementById('pressureText');
const media = document.getElementById('filterMedia');

  if (!indicator || !pressureText || !media) return;

      pressureText.textContent = _pn_pressureDrop.toFixed(2) + ' in';

      // Determine status from pressure drop
      if (_pn_pressureDrop >= _pn_dpAlarmHigh) {
        indicator.setAttribute('class', 'status-alarm');
        media.querySelector('path').setAttribute('class', 'filter-media filter-dirty');
      } else if (_pn_pressureDrop >= _pn_dpWarning) {
        indicator.setAttribute('class', 'status-warning');
      } else {
        indicator.setAttribute('class', 'status-good');
      }

      // Visual dirt accumulation
let dirtLevel = Math.min(1, _pn_pressureDrop / _pn_dpAlarmHigh);
let paths = media.querySelectorAll('path');
      paths.forEach(function(path, index) {
        if (index / paths.length < dirtLevel) {
          path.style.fill = '#8d6e63';
        } else {
          path.style.fill = '#ecf0f1';
        }
      });
    }

function putValue(id, value) {
  if (id === '_pn_pressureDrop') {
    _pn_pressureDrop = Number(value) || 0;
    update();
  } else if (id === '_pn_dpAlarmHigh') {
    _pn_dpAlarmHigh = Number(value) || 0;
    update();
  } else if (id === '_pn_dpWarning') {
    _pn_dpWarning = Number(value) || 0;
    update();
  } else if (id === '_pn_filterStatus') {
    _pn_filterStatus = Number(value) || 0;
    update();
  }
}

init();

]]></script>
</svg>
