<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 85" width="100" height="85">
  <defs>
    <style>
      .duct { fill: #bdc3c7; stroke: #34495e; stroke-width: 2; }
      .coil-tube { fill: none; stroke: #5dade2; stroke-width: 3; }
      .coil-tube-active { stroke: #3498db; }
      .fin { fill: #95a5a6; stroke: #7f8c8d; stroke-width: 0.5; }
      .pipe { fill: none; stroke: #3498db; stroke-width: 3; }
      .valve { fill: #7f8c8d; stroke: #2c3e50; stroke-width: 1.5; }
      .droplet { fill: #3498db; opacity: 0.7; }
      .value-text { font-family: Arial, sans-serif; font-size: 10px; fill: #2c3e50; text-anchor: middle; font-weight: bold; }
    </style>
  </defs>

  <!-- Duct/Casing -->
  <rect x="5" y="20" width="90" height="40" class="duct" rx="2"/>

  <!-- Cooling Coil Fins -->
  <g id="fins">
    <rect x="15" y="22" width="2" height="36" class="fin"/>
    <rect x="20" y="22" width="2" height="36" class="fin"/>
    <rect x="25" y="22" width="2" height="36" class="fin"/>
    <rect x="30" y="22" width="2" height="36" class="fin"/>
    <rect x="35" y="22" width="2" height="36" class="fin"/>
    <rect x="40" y="22" width="2" height="36" class="fin"/>
    <rect x="45" y="22" width="2" height="36" class="fin"/>
    <rect x="50" y="22" width="2" height="36" class="fin"/>
    <rect x="55" y="22" width="2" height="36" class="fin"/>
    <rect x="60" y="22" width="2" height="36" class="fin"/>
    <rect x="65" y="22" width="2" height="36" class="fin"/>
    <rect x="70" y="22" width="2" height="36" class="fin"/>
    <rect x="75" y="22" width="2" height="36" class="fin"/>
    <rect x="80" y="22" width="2" height="36" class="fin"/>
  </g>

  <!-- Cooling Coil Tubes (serpentine pattern) -->
  <g id="coilTubes">
    <path class="coil-tube" d="M 12 28 L 85 28"/>
    <path class="coil-tube" d="M 85 28 L 85 35"/>
    <path class="coil-tube" d="M 85 35 L 12 35"/>
    <path class="coil-tube" d="M 12 35 L 12 42"/>
    <path class="coil-tube" d="M 12 42 L 85 42"/>
    <path class="coil-tube" d="M 85 42 L 85 49"/>
    <path class="coil-tube" d="M 85 49 L 12 49"/>
  </g>

  <!-- Condensate Droplets (when active) -->
  <g id="condensate" opacity="0">
    <ellipse class="droplet" cx="30" cy="58" rx="2" ry="3"/>
    <ellipse class="droplet" cx="45" cy="58" rx="2" ry="3"/>
    <ellipse class="droplet" cx="60" cy="58" rx="2" ry="3"/>
    <ellipse class="droplet" cx="75" cy="58" rx="2" ry="3"/>
  </g>

  <!-- Drain Pan -->
  <path d="M 10 60 L 10 63 L 90 63 L 90 60" fill="#7f8c8d" stroke="#2c3e50" stroke-width="1"/>

  <!-- Chilled Water Supply -->
  <line x1="5" y1="10" x2="12" y2="28" class="pipe"/>
  <text x="2" y="8" class="value-text" font-size="8">CHW SUP</text>

  <!-- Chilled Water Return -->
  <line x1="12" y1="49" x2="5" y2="70" class="pipe"/>
  <text x="2" y="80" class="value-text" font-size="8">CHW RET</text>

  <!-- Valve -->
  <rect x="3" y="8" width="4" height="6" class="valve" rx="1"/>

  <!-- Temperature Display -->
  <rect x="35" y="70" width="30" height="12" fill="#ecf0f1" stroke="#95a5a6" stroke-width="1" rx="2"/>
  <text id="tempText" x="50" y="78" class="value-text">---째F</text>

  <script type="text/javascript">
    <![CDATA[
    var valvePosition = 0;     // 0-100 (%)
    var supplyTemp = 0;        // CHW supply temperature
    var returnTemp = 0;        // CHW return temperature
    var airTempOut = 0;        // Discharge air temp
    var active = 0;            // 0=off, 1=active

    function updateWidget() {
      var coilTubes = document.getElementById('coilTubes');
      var tempText = document.getElementById('tempText');
      var condensate = document.getElementById('condensate');

      if (valvePosition > 10 && supplyTemp > 0) {
        // Active cooling
        var paths = coilTubes.querySelectorAll('path');
        paths.forEach(function(path) {
          path.setAttribute('class', 'coil-tube coil-tube-active');
        });

        // Show condensate
        condensate.setAttribute('opacity', valvePosition / 100);

        if (airTempOut > 0) {
          tempText.textContent = Math.round(airTempOut) + '째F';
        } else {
          tempText.textContent = Math.round(supplyTemp) + '째F';
        }
      } else {
        // Inactive
        var paths = coilTubes.querySelectorAll('path');
        paths.forEach(function(path) {
          path.setAttribute('class', 'coil-tube');
        });
        condensate.setAttribute('opacity', '0');
        tempText.textContent = '---째F';
      }
    }

    updateWidget();
    ]]>
  </script>
</svg>
