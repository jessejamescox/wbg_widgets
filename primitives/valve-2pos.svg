<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 100" width="100%" height="100%">
  <defs>
    <style>
      .valve-body { fill: #7f8c8d; stroke: #2c3e50; stroke-width: 2; }
      .valve-stem { fill: #95a5a6; stroke: #2c3e50; stroke-width: 1.5; }
      .valve-indicator { transition: transform 0.5s; transform-origin: 40px 35px; }
      .pipe { fill: none; stroke: #34495e; stroke-width: 4; }
      .status-text { font-family: Arial, sans-serif; font-size: 11px; fill: #2c3e50; text-anchor: middle; font-weight: bold; }
      .valve-closed { fill: #e74c3c; }
      .valve-open { fill: #27ae60; }
    </style>
  </defs>

  <!-- Inlet Pipe -->
  <line x1="40" y1="10" x2="40" y2="25" class="pipe"/>

  <!-- Valve Body -->
  <rect x="25" y="25" width="30" height="30" class="valve-body" rx="3"/>

  <!-- Valve Stem (rotates) -->
  <g id="valveStem" class="valve-indicator">
    <rect x="37" y="20" width="6" height="20" class="valve-stem" rx="1"/>
    <circle cx="40" cy="20" r="4" fill="#34495e"/>
  </g>

  <!-- Position Indicator Arc -->
  <path d="M 15 35 A 25 25 0 0 1 65 35" fill="none" stroke="#bdc3c7" stroke-width="2"/>
  <circle id="posIndicator" cx="15" cy="35" r="3" class="valve-closed"/>

  <!-- Outlet Pipe -->
  <line x1="40" y1="55" x2="40" y2="75" class="pipe"/>

  <!-- Status Display -->
  <rect x="10" y="80" width="60" height="18" fill="#ecf0f1" stroke="#95a5a6" stroke-width="1" rx="3"/>
  <text id="statusText" x="40" y="92" class="status-text">CLOSED</text>

  <script><![CDATA[
//!export-start
let _pn_position = 0;
let _pn_feedback = 0;
//!export-end

function init() {
  update();
}

    function update() {
const stem = document.getElementById('valveStem');
const indicator = document.getElementById('posIndicator');
const statusText = document.getElementById('statusText');

  if (!stem || !indicator || !statusText) return;

      if (_pn_position === 1) {
        // Open _pn_position - rotate 90 degrees
        stem.setAttribute('transform', 'rotate(90 40 35)');
        indicator.setAttribute('cx', '65');
        indicator.setAttribute('class', 'valve-open');
        statusText.textContent = 'OPEN';
      } else {
        // Closed _pn_position
        stem.setAttribute('transform', 'rotate(0 40 35)');
        indicator.setAttribute('cx', '15');
        indicator.setAttribute('class', 'valve-closed');
        statusText.textContent = 'CLOSED';
      }

      // Show _pn_feedback mismatch
      if (_pn_position !== _pn_feedback) {
        statusText.textContent = 'MOVING...';
        indicator.setAttribute('fill', '#f39c12');
      }
    }

function putValue(id, value) {
  if (id === '_pn_position') {
    _pn_position = Number(value) || 0;
    update();
  } else if (id === '_pn_feedback') {
    _pn_feedback = Number(value) || 0;
    update();
  }
}

init();

]]></script>
</svg>
