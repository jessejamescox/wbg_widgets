<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 500">
  <defs>
    <style>
      .office-bg { fill: #1a1a2e; }
      .office-header { fill: #16213e; }
      .office-card { fill: #2d3748; }
      .office-text-primary { fill: #ffffff; font-family: 'Segoe UI', Arial, sans-serif; font-size: 16px; font-weight: 600; }
      .office-text-secondary { fill: #a0aec0; font-family: 'Segoe UI', Arial, sans-serif; font-size: 13px; }
      .office-text-large { fill: #ffffff; font-family: 'Segoe UI', Arial, sans-serif; font-size: 24px; font-weight: 700; }
      .office-text-medium { fill: #ffffff; font-family: 'Segoe UI', Arial, sans-serif; font-size: 14px; font-weight: 600; }
      .office-text-small { fill: #cbd5e0; font-family: 'Segoe UI', Arial, sans-serif; font-size: 11px; }
      .office-icon { fill: none; stroke: #4299e1; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
      .office-border { fill: none; stroke: #2d3748; stroke-width: 2; }
      .office-space { fill: #2d3748; stroke: #4a5568; stroke-width: 1; cursor: pointer; }
      .office-space:hover { fill: #3d4758; }
      .office-vav { fill: #2d3748; stroke: #4299e1; stroke-width: 1; }
      .temp-cold { fill: #4299e1; }
      .temp-cool { fill: #68d391; }
      .temp-neutral { fill: #48bb78; }
      .temp-warm { fill: #ed8936; }
      .temp-hot { fill: #f56565; }
    </style>

    <linearGradient id="tempMapGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#4299e1;stop-opacity:1" />
      <stop offset="25%" style="stop-color:#68d391;stop-opacity:1" />
      <stop offset="50%" style="stop-color:#48bb78;stop-opacity:1" />
      <stop offset="75%" style="stop-color:#ed8936;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#f56565;stop-opacity:1" />
    </linearGradient>
  </defs>

  <!-- Main Background -->
  <rect class="office-bg" x="0" y="0" width="700" height="500" rx="12"/>
  <rect class="office-border" x="0" y="0" width="700" height="500" rx="12"/>

  <!-- Header -->
  <rect class="office-header" x="0" y="0" width="700" height="60" rx="12"/>
  <rect class="office-header" x="0" y="30" width="700" height="30"/>
  <text class="office-text-large" x="20" y="38" id="zoneName">Office Zone - 3rd Floor</text>

  <!-- Zone Summary Stats -->
  <g transform="translate(450, 20)">
    <g transform="translate(0, 0)">
      <text class="office-text-small" x="0" y="0">Avg Temp:</text>
      <text class="office-text-medium" x="0" y="16" id="avgTemp">72°F</text>
    </g>
    <g transform="translate(80, 0)">
      <text class="office-text-small" x="0" y="0">Occupancy:</text>
      <text class="office-text-medium" x="0" y="16" id="totalOccupancy">24/30</text>
    </g>
    <g transform="translate(160, 0)">
      <text class="office-text-small" x="0" y="0">VAV Boxes:</text>
      <text class="office-text-medium" x="0" y="16" id="vavStatus">6 Active</text>
    </g>
  </g>

  <!-- Temperature Map Section -->
  <g transform="translate(20, 80)">
    <rect class="office-card" x="0" y="0" width="420" height="300" rx="8"/>
    <rect class="office-border" x="0" y="0" width="420" height="300" rx="8"/>

    <text class="office-text-primary" x="15" y="25">Temperature Distribution Map</text>

    <!-- Floor Plan Grid -->
    <g transform="translate(20, 45)">
      <!-- Space 1 -->
      <g id="space1" class="office-space">
        <rect x="0" y="0" width="90" height="100" rx="4" class="temp-neutral"/>
        <text class="office-text-medium" x="45" y="45" text-anchor="middle" fill="#ffffff">Office 301</text>
        <text class="office-text-small" x="45" y="65" text-anchor="middle" fill="#ffffff" id="temp1">72°F</text>
        <text class="office-text-small" x="45" y="80" text-anchor="middle" fill="#cbd5e0" id="occ1">3 people</text>
      </g>

      <!-- Space 2 -->
      <g id="space2" class="office-space" transform="translate(100, 0)">
        <rect x="0" y="0" width="90" height="100" rx="4" class="temp-cool"/>
        <text class="office-text-medium" x="45" y="45" text-anchor="middle" fill="#ffffff">Office 302</text>
        <text class="office-text-small" x="45" y="65" text-anchor="middle" fill="#ffffff" id="temp2">70°F</text>
        <text class="office-text-small" x="45" y="80" text-anchor="middle" fill="#cbd5e0" id="occ2">2 people</text>
      </g>

      <!-- Space 3 -->
      <g id="space3" class="office-space" transform="translate(200, 0)">
        <rect x="0" y="0" width="90" height="100" rx="4" class="temp-warm"/>
        <text class="office-text-medium" x="45" y="45" text-anchor="middle" fill="#ffffff">Office 303</text>
        <text class="office-text-small" x="45" y="65" text-anchor="middle" fill="#ffffff" id="temp3">74°F</text>
        <text class="office-text-small" x="45" y="80" text-anchor="middle" fill="#cbd5e0" id="occ3">5 people</text>
      </g>

      <!-- Space 4 -->
      <g id="space4" class="office-space" transform="translate(300, 0)">
        <rect x="0" y="0" width="90" height="100" rx="4" class="temp-neutral"/>
        <text class="office-text-medium" x="45" y="45" text-anchor="middle" fill="#ffffff">Meeting A</text>
        <text class="office-text-small" x="45" y="65" text-anchor="middle" fill="#ffffff" id="temp4">71°F</text>
        <text class="office-text-small" x="45" y="80" text-anchor="middle" fill="#cbd5e0" id="occ4">8 people</text>
      </g>

      <!-- Space 5 -->
      <g id="space5" class="office-space" transform="translate(0, 110)">
        <rect x="0" y="0" width="140" height="110" rx="4" class="temp-cool"/>
        <text class="office-text-medium" x="70" y="50" text-anchor="middle" fill="#ffffff">Open Office</text>
        <text class="office-text-small" x="70" y="70" text-anchor="middle" fill="#ffffff" id="temp5">69°F</text>
        <text class="office-text-small" x="70" y="85" text-anchor="middle" fill="#cbd5e0" id="occ5">4 people</text>
      </g>

      <!-- Space 6 -->
      <g id="space6" class="office-space" transform="translate(150, 110)">
        <rect x="0" y="0" width="140" height="110" rx="4" class="temp-neutral"/>
        <text class="office-text-medium" x="70" y="50" text-anchor="middle" fill="#ffffff">Break Room</text>
        <text class="office-text-small" x="70" y="70" text-anchor="middle" fill="#ffffff" id="temp6">73°F</text>
        <text class="office-text-small" x="70" y="85" text-anchor="middle" fill="#cbd5e0" id="occ6">2 people</text>
      </g>

      <!-- Space 7 -->
      <g id="space7" class="office-space" transform="translate(300, 110)">
        <rect x="0" y="0" width="90" height="110" rx="4" class="temp-cold"/>
        <text class="office-text-medium" x="45" y="50" text-anchor="middle" fill="#ffffff">Server</text>
        <text class="office-text-small" x="45" y="70" text-anchor="middle" fill="#ffffff" id="temp7">65°F</text>
        <text class="office-text-small" x="45" y="85" text-anchor="middle" fill="#cbd5e0" id="occ7">0 people</text>
      </g>
    </g>

    <!-- Temperature Scale Legend -->
    <g transform="translate(20, 240)">
      <rect x="0" y="0" width="380" height="15" rx="4" fill="url(#tempMapGradient)"/>
      <text class="office-text-small" x="0" y="30">60°F</text>
      <text class="office-text-small" x="170" y="30" text-anchor="middle">72°F</text>
      <text class="office-text-small" x="380" y="30" text-anchor="end">85°F</text>
    </g>
  </g>

  <!-- VAV Boxes Panel -->
  <g transform="translate(460, 80)">
    <rect class="office-card" x="0" y="0" width="220" height="300" rx="8"/>
    <rect class="office-border" x="0" y="0" width="220" height="300" rx="8"/>

    <text class="office-text-primary" x="15" y="25">VAV Box Status</text>

    <!-- VAV Box 1 -->
    <g transform="translate(15, 40)">
      <rect class="office-vav" x="0" y="0" width="190" height="35" rx="4"/>
      <text class="office-text-medium" x="10" y="14">VAV-301</text>
      <text class="office-text-small" x="10" y="28" id="vav1Status">Cooling - 65%</text>
      <circle id="vav1Indicator" fill="#48bb78" cx="175" cy="17.5" r="6"/>
    </g>

    <!-- VAV Box 2 -->
    <g transform="translate(15, 85)">
      <rect class="office-vav" x="0" y="0" width="190" height="35" rx="4"/>
      <text class="office-text-medium" x="10" y="14">VAV-302</text>
      <text class="office-text-small" x="10" y="28" id="vav2Status">Cooling - 45%</text>
      <circle id="vav2Indicator" fill="#48bb78" cx="175" cy="17.5" r="6"/>
    </g>

    <!-- VAV Box 3 -->
    <g transform="translate(15, 130)">
      <rect class="office-vav" x="0" y="0" width="190" height="35" rx="4"/>
      <text class="office-text-medium" x="10" y="14">VAV-303</text>
      <text class="office-text-small" x="10" y="28" id="vav3Status">Heating - 30%</text>
      <circle id="vav3Indicator" fill="#f56565" cx="175" cy="17.5" r="6"/>
    </g>

    <!-- VAV Box 4 -->
    <g transform="translate(15, 175)">
      <rect class="office-vav" x="0" y="0" width="190" height="35" rx="4"/>
      <text class="office-text-medium" x="10" y="14">VAV-304</text>
      <text class="office-text-small" x="10" y="28" id="vav4Status">Cooling - 55%</text>
      <circle id="vav4Indicator" fill="#48bb78" cx="175" cy="17.5" r="6"/>
    </g>

    <!-- VAV Box 5 -->
    <g transform="translate(15, 220)">
      <rect class="office-vav" x="0" y="0" width="190" height="35" rx="4"/>
      <text class="office-text-medium" x="10" y="14">VAV-305</text>
      <text class="office-text-small" x="10" y="28" id="vav5Status">Cooling - 40%</text>
      <circle id="vav5Indicator" fill="#48bb78" cx="175" cy="17.5" r="6"/>
    </g>

    <!-- VAV Box 6 -->
    <g transform="translate(15, 265)">
      <rect class="office-vav" x="0" y="0" width="190" height="35" rx="4"/>
      <text class="office-text-medium" x="10" y="14">VAV-306</text>
      <text class="office-text-small" x="10" y="28" id="vav6Status">Cooling - 85%</text>
      <circle id="vav6Indicator" fill="#48bb78" cx="175" cy="17.5" r="6"/>
    </g>
  </g>

  <!-- System Alerts -->
  <g transform="translate(20, 400)">
    <rect class="office-card" x="0" y="0" width="660" height="80" rx="8"/>
    <rect class="office-border" x="0" y="0" width="660" height="80" rx="8"/>

    <text class="office-text-primary" x="15" y="25">System Status</text>

    <g transform="translate(15, 35)">
      <circle fill="#48bb78" cx="0" cy="5" r="5"/>
      <text class="office-text-small" x="15" y="10" id="alert1">All VAV boxes operating normally</text>
    </g>

    <g transform="translate(15, 55)">
      <circle fill="#ed8936" cx="0" cy="5" r="5"/>
      <text class="office-text-small" x="15" y="10" id="alert2">High occupancy in Office 303 - Consider temp adjustment</text>
    </g>
  </g>

  <script><![CDATA[
//!export-start
let _pn_totalTemp = 0;
let _pn_totalOcc = 0;
let _pn_tempCount = 0;
let _pn_activeVavs = 0;
//!export-end

function init() {
  update();
}

(function() {
      // FUXA Variable Bindings
let variables = {
        zoneName: 'office_zone_name',
        spaces: [
          { temp: 'office_space1_temp', occ: 'office_space1_occ', name: 'office_space1_name' },
          { temp: 'office_space2_temp', occ: 'office_space2_occ', name: 'office_space2_name' },
          { temp: 'office_space3_temp', occ: 'office_space3_occ', name: 'office_space3_name' },
          { temp: 'office_space4_temp', occ: 'office_space4_occ', name: 'office_space4_name' },
          { temp: 'office_space5_temp', occ: 'office_space5_occ', name: 'office_space5_name' },
          { temp: 'office_space6_temp', occ: 'office_space6_occ', name: 'office_space6_name' },
          { temp: 'office_space7_temp', occ: 'office_space7_occ', name: 'office_space7_name' }
        ],
        vavBoxes: [
          { status: 'office_vav1_status', damper: 'office_vav1_damper', mode: 'office_vav1_mode' },
          { status: 'office_vav2_status', damper: 'office_vav2_damper', mode: 'office_vav2_mode' },
          { status: 'office_vav3_status', damper: 'office_vav3_damper', mode: 'office_vav3_mode' },
          { status: 'office_vav4_status', damper: 'office_vav4_damper', mode: 'office_vav4_mode' },
          { status: 'office_vav5_status', damper: 'office_vav5_damper', mode: 'office_vav5_mode' },
          { status: 'office_vav6_status', damper: 'office_vav6_damper', mode: 'office_vav6_mode' }
        ]
      };

      function getTempClass(temp) {
        if (temp < 68) return 'temp-cold';
        if (temp < 70) return 'temp-cool';
        if (temp < 74) return 'temp-neutral';
        if (temp < 76) return 'temp-warm';
        return 'temp-hot';
      }

      function updateWidget(data) {
        try {
          // Update zone name
          if (data[variables.zoneName] !== undefined) {
            document.getElementById('zoneName').textContent = data[variables.zoneName];
          }

          // Update spaces

          variables.spaces.forEach(function(space, index) {
let spaceNum = index + 1;

            if (data[space.temp] !== undefined) {
let temp = parseFloat(data[space.temp]);
              _pn_totalTemp += temp;
              _pn_tempCount++;
const tempElem = document.getElementById('temp' + spaceNum);
              tempElem.textContent = Math.round(temp) + '°F';

              // Update temperature color
let spaceRect = document.querySelector('#space' + spaceNum + ' rect');
              spaceRect.setAttribute('class', getTempClass(temp));
            }

            if (data[space.occ] !== undefined) {
let occ = parseInt(data[space.occ]);
              _pn_totalOcc += occ;
              document.getElementById('occ' + spaceNum).textContent = occ + ' people';
            }
          });

          // Update average temperature
          if (_pn_tempCount > 0) {
let avgTemp = Math.round(_pn_totalTemp / _pn_tempCount);
            document.getElementById('avgTemp').textContent = avgTemp + '°F';
          }

          // Update total occupancy
          document.getElementById('totalOccupancy').textContent = _pn_totalOcc + '/30';

          // Update VAV boxes

          variables.vavBoxes.forEach(function(vav, index) {
let vavNum = index + 1;

            if (data[vav.mode] !== undefined && data[vav.damper] !== undefined) {
let mode = data[vav.mode]; // 0=off, 1=heating, 2=cooling
let damper = parseFloat(data[vav.damper]);
let modeText = ['Off', 'Heating', 'Cooling'][mode] || 'Unknown';
let statusText = modeText + ' - ' + Math.round(damper) + '%';

              document.getElementById('vav' + vavNum + 'Status').textContent = statusText;

              // Update indicator color
const indicator = document.getElementById('vav' + vavNum + 'Indicator');
              if (mode === 0) {
                indicator.setAttribute('fill', '#718096'); // Gray for off
              } else if (mode === 1) {
                indicator.setAttribute('fill', '#f56565'); // Red for heating
                _pn_activeVavs++;
              } else if (mode === 2) {
                indicator.setAttribute('fill', '#48bb78'); // Green for cooling
                _pn_activeVavs++;
              }
            }
          });

          // Update VAV status summary
          document.getElementById('vavStatus').textContent = _pn_activeVavs + ' Active';

        } catch (error) {
          console.error('Office Zone update error:', error);
        }
      }

      // Space click handlers
      for (var i = 1; i <= 7; i++) {
        (function(spaceNum) {
const spaceElem = document.getElementById('space' + spaceNum);
          if (spaceElem) {
            spaceElem.addEventListener('click', function() {
              if (window.fuxa && window.fuxa.navigateToSpace) {
                window.fuxa.navigateToSpace('space' + spaceNum);
              } else {
                console.log('Clicked space ' + spaceNum);
              }
            });
          }
        })(i);
      }

      // Register with FUXA
      if (window.fuxa) {
let allVars = [variables.zoneName];
        variables.spaces.forEach(function(s) {
          allVars.push(s.temp, s.occ, s.name);
        });
        variables.vavBoxes.forEach(function(v) {
          allVars.push(v.status, v.damper, v.mode);
        });

        window.fuxa.registerWidget({
          id: 'office-zone',
          variables: allVars,
          update: updateWidget
        });
      }

      // Make update function globally accessible
      window.updateOfficeZone = updateWidget;
    })();

function putValue(id, value) {
  if (id === '_pn_totalTemp') {
    _pn_totalTemp = Number(value) || 0;
    update();
  } else if (id === '_pn_totalOcc') {
    _pn_totalOcc = Number(value) || 0;
    update();
  } else if (id === '_pn_tempCount') {
    _pn_tempCount = Number(value) || 0;
    update();
  } else if (id === '_pn_activeVavs') {
    _pn_activeVavs = Number(value) || 0;
    update();
  }
}

init();

]]></script>
</svg>
