<?xml version="1.0" encoding="UTF-8"?>
<svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <defs>
    <style>
      .btn-container { cursor: pointer; }
      .btn-rect {
        fill: #2196F3;
        stroke: #1976D2;
        stroke-width: 2;
        transition: all 0.2s;
      }
      .btn-rect.running { fill: #F44336; stroke: #C62828; }
      .btn-rect:hover { filter: brightness(1.1); }
      .btn-rect:active { filter: brightness(0.9); }
      .btn-text {
        fill: white;
        font-family: Arial, sans-serif;
        font-size: 18px;
        font-weight: bold;
        text-anchor: middle;
        pointer-events: none;
      }
      .label-text {
        fill: #555;
        font-family: Arial, sans-serif;
        font-size: 10px;
        text-anchor: middle;
      }
      .status-led {
        transition: all 0.3s;
      }
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.3; }
      }
      .status-led.running { animation: pulse 1s infinite; }
    </style>
  </defs>

  <!-- Label -->
  <text class="label-text" x="60" y="12">RUN STATUS</text>

  <!-- Button Container -->
  <g class="btn-container" id="btnGroup">
    <!-- Button Background -->
    <rect class="btn-rect" id="btnRect" x="10" y="20" width="100" height="60" rx="8"/>

    <!-- Button Text -->
    <text class="btn-text" id="btnText" x="60" y="57">START</text>
  </g>

  <!-- Status LED -->
  <circle class="status-led" id="statusLED" cx="60" cy="92" r="6" fill="#999" stroke="#666" stroke-width="1"/>

  <script><![CDATA[
//!export-start
let _pb_isRunning = false;
let _ps_tagId = '';
let _ps_cmdTagId = '';
//!export-end

function init() {
  update();
}

(function() {
      // FUXA Integration Variables

      // DOM Elements
const btnRect = document.getElementById('btnRect');
const btnText = document.getElementById('btnText');
const statusLED = document.getElementById('statusLED');
const btnGroup = document.getElementById('btnGroup');

      // Update visual state
      function updateVisuals() {
        if (_pb_isRunning) {
          btnRect.classList.add('running');
          btnText.textContent = 'STOP';
          statusLED.setAttribute('fill', '#4CAF50');
          statusLED.classList.add('running');
        } else {
          btnRect.classList.remove('running');
          btnText.textContent = 'START';
          statusLED.setAttribute('fill', '#999');
          statusLED.classList.remove('running');
        }
      }

      // Click handler - momentary action
      btnGroup.addEventListener('mousedown', function(evt) {
        evt.preventDefault();

        // Send momentary pulse command
        if (typeof GAuxy !== 'undefined' && _ps_cmdTagId) {
let command = _pb_isRunning ? 0 : 1; // 1 for START, 0 for STOP
          GAuxy.setVariable(_ps_cmdTagId, command);

          // Reset command after 200ms (momentary)
          setTimeout(function() {
            if (typeof GAuxy !== 'undefined' && _ps_cmdTagId) {
              GAuxy.setVariable(_ps_cmdTagId, -1); // Reset command
            }
          }, 200);
        }
      });

      // FUXA Integration Functions
      window.svgSetValue = function(sigid, value) {
        if (sigid === _ps_tagId) {
          _pb_isRunning = (value > 0);
          updateVisuals();
        }
      };

      window.svgGetProperty = function(name) {
        if (name === 'variableId') return _ps_tagId;
        if (name === 'cmdVariableId') return _ps_cmdTagId;
        return null;
      };

      window.svgSetProperty = function(name, value) {
        if (name === 'variableId') {
          _ps_tagId = value;
        } else if (name === 'cmdVariableId') {
          _ps_cmdTagId = value;
        }
      };

      // Initialize
      updateVisuals();
    })();

function putValue(id, value) {
  if (id === '_pb_isRunning') {
    _pb_isRunning = !!value;
    update();
  } else if (id === '_ps_tagId') {
    _ps_tagId = String(value) || "";
    update();
  } else if (id === '_ps_cmdTagId') {
    _ps_cmdTagId = String(value) || "";
    update();
  }
}

init();

]]></script>
</svg>
