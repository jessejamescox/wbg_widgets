<?xml version="1.0" encoding="UTF-8"?>
<svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <defs>
    <style>
      .card-bg {
        fill: white;
        stroke: #ccc;
        stroke-width: 2;
      }
      .header-bg {
        fill: #2196F3;
      }
      .header-text {
        fill: white;
        font-family: Arial, sans-serif;
        font-size: 14px;
        font-weight: bold;
      }
      .label-text {
        fill: #666;
        font-family: Arial, sans-serif;
        font-size: 11px;
      }
      .value-text {
        fill: #333;
        font-family: 'Courier New', monospace;
        font-size: 18px;
        font-weight: bold;
      }
      .value-text.pv { fill: #2196F3; }
      .value-text.sp { fill: #FF9800; }
      .value-text.out { fill: #4CAF50; }
      .term-text {
        fill: #555;
        font-family: Arial, sans-serif;
        font-size: 10px;
      }
      .term-value {
        fill: #333;
        font-family: 'Courier New', monospace;
        font-size: 11px;
      }
      .mode-btn {
        cursor: pointer;
        transition: all 0.2s;
      }
      .mode-btn-rect {
        fill: #e0e0e0;
        stroke: #999;
        stroke-width: 1;
      }
      .mode-btn-rect.active {
        fill: #4CAF50;
        stroke: #388E3C;
      }
      .mode-btn-text {
        fill: #333;
        font-family: Arial, sans-serif;
        font-size: 10px;
        font-weight: bold;
        text-anchor: middle;
        pointer-events: none;
      }
      .mode-btn-text.active {
        fill: white;
      }
      .mode-btn:hover .mode-btn-rect {
        filter: brightness(1.1);
      }
      .divider {
        stroke: #ddd;
        stroke-width: 1;
      }
      .unit-text {
        fill: #999;
        font-family: Arial, sans-serif;
        font-size: 9px;
      }
    </style>
  </defs>

  <!-- Card Background -->
  <rect class="card-bg" x="0" y="0" width="320" height="200" rx="5"/>

  <!-- Header -->
  <rect class="header-bg" x="0" y="0" width="320" height="30" rx="5"/>
  <text class="header-text" x="10" y="20">PID CONTROLLER</text>

  <!-- Main Values Section -->
  <g id="mainValues">
    <!-- Process Variable (PV) -->
    <text class="label-text" x="15" y="50">PV</text>
    <text class="value-text pv" id="pvValue" x="15" y="72">75.5</text>
    <text class="unit-text" id="pvUnit" x="70" y="72">°F</text>

    <!-- Setpoint (SP) -->
    <text class="label-text" x="115" y="50">SP</text>
    <text class="value-text sp" id="spValue" x="115" y="72">72.0</text>
    <text class="unit-text" id="spUnit" x="170" y="72">°F</text>

    <!-- Output -->
    <text class="label-text" x="215" y="50">OUTPUT</text>
    <text class="value-text out" id="outValue" x="215" y="72">45.2</text>
    <text class="unit-text" x="270" y="72">%</text>
  </g>

  <!-- Divider -->
  <line class="divider" x1="10" y1="85" x2="310" y2="85"/>

  <!-- PID Terms Section -->
  <g id="pidTerms">
    <text class="label-text" x="15" y="105">PID TERMS</text>

    <!-- P Term -->
    <text class="term-text" x="15" y="120">P:</text>
    <text class="term-value" id="pValue" x="35" y="120">12.3</text>

    <!-- I Term -->
    <text class="term-text" x="85" y="120">I:</text>
    <text class="term-value" id="iValue" x="100" y="120">8.5</text>

    <!-- D Term -->
    <text class="term-text" x="150" y="120">D:</text>
    <text class="term-value" id="dValue" x="165" y="120">-2.1</text>

    <!-- Error -->
    <text class="term-text" x="215" y="120">ERR:</text>
    <text class="term-value" id="errValue" x="240" y="120">3.5</text>
  </g>

  <!-- Divider -->
  <line class="divider" x1="10" y1="135" x2="310" y2="135"/>

  <!-- Mode Control -->
  <text class="label-text" x="15" y="155">MODE</text>

  <!-- Auto Button -->
  <g class="mode-btn" id="autoBtn">
    <rect class="mode-btn-rect" id="autoBtnRect" x="15" y="165" width="60" height="25" rx="3"/>
    <text class="mode-btn-text" id="autoBtnText" x="45" y="182">AUTO</text>
  </g>

  <!-- Manual Button -->
  <g class="mode-btn" id="manualBtn">
    <rect class="mode-btn-rect" id="manualBtnRect" x="85" y="165" width="60" height="25" rx="3"/>
    <text class="mode-btn-text" id="manualBtnText" x="115" y="182">MANUAL</text>
  </g>

  <!-- Status Text -->
  <text class="term-text" id="statusText" x="160" y="182">Auto Mode Active</text>

  <script><![CDATA[
//!export-start
let _ps_pvTagId = '';
let _ps_spTagId = '';
let _ps_outTagId = '';
let _ps_pTagId = '';
let _ps_iTagId = '';
let _ps_dTagId = '';
let _ps_errTagId = '';
let _ps_modeTagId = '';
let _ps_modeCmdTagId = '';
let _pn_pv = 75.5;
let _pn_sp = 72.0;
let _pn_output = 45.2;
let _pn_pTerm = 12.3;
let _pn_iTerm = 8.5;
let _pn_dTerm = -2.1;
let _pn_error = 3.5;
let _pb_isAuto = true;
let _ps_units = '°F';
let _pn_decimals = 1;
//!export-end

function init() {
  update();
}

(function() {
      // FUXA Integration Variables

      // Current values

      // DOM Elements
const pvValue = document.getElementById('pvValue');
const spValue = document.getElementById('spValue');
const outValue = document.getElementById('outValue');
const pValue = document.getElementById('pValue');
const iValue = document.getElementById('iValue');
const dValue = document.getElementById('dValue');
const errValue = document.getElementById('errValue');
const statusText = document.getElementById('statusText');
const autoBtnRect = document.getElementById('autoBtnRect');
const autoBtnText = document.getElementById('autoBtnText');
const manualBtnRect = document.getElementById('manualBtnRect');
const manualBtnText = document.getElementById('manualBtnText');
const autoBtn = document.getElementById('autoBtn');
const manualBtn = document.getElementById('manualBtn');
const pvUnit = document.getElementById('pvUnit');
const spUnit = document.getElementById('spUnit');

      // Update all visuals
      function updateVisuals() {
        pvValue.textContent = _pn_pv.toFixed(_pn_decimals);
        spValue.textContent = _pn_sp.toFixed(_pn_decimals);
        outValue.textContent = _pn_output.toFixed(_pn_decimals);
        pValue.textContent = _pn_pTerm.toFixed(_pn_decimals);
        iValue.textContent = _pn_iTerm.toFixed(_pn_decimals);
        dValue.textContent = _pn_dTerm.toFixed(_pn_decimals);
        errValue.textContent = _pn_error.toFixed(_pn_decimals);
        pvUnit.textContent = _ps_units;
        spUnit.textContent = _ps_units;

        if (_pb_isAuto) {
          autoBtnRect.classList.add('active');
          autoBtnText.classList.add('active');
          manualBtnRect.classList.remove('active');
          manualBtnText.classList.remove('active');
          statusText.textContent = 'Auto Mode Active';
        } else {
          autoBtnRect.classList.remove('active');
          autoBtnText.classList.remove('active');
          manualBtnRect.classList.add('active');
          manualBtnText.classList.add('active');
          statusText.textContent = 'Manual Mode Active';
        }
      }

      // Mode button handlers
      autoBtn.addEventListener('click', function(evt) {
        evt.preventDefault();
        if (!_pb_isAuto) {
          _pb_isAuto = true;
          updateVisuals();

          if (typeof GAuxy !== 'undefined' && _ps_modeCmdTagId) {
            GAuxy.setVariable(_ps_modeCmdTagId, 1);
          }
        }
      });

      manualBtn.addEventListener('click', function(evt) {
        evt.preventDefault();
        if (_pb_isAuto) {
          _pb_isAuto = false;
          updateVisuals();

          if (typeof GAuxy !== 'undefined' && _ps_modeCmdTagId) {
            GAuxy.setVariable(_ps_modeCmdTagId, 0);
          }
        }
      });

      // FUXA Integration Functions
      window.svgSetValue = function(sigid, value) {
let numValue = parseFloat(value);

        if (sigid === _ps_pvTagId) {
          _pn_pv = numValue;
        } else if (sigid === _ps_spTagId) {
          _pn_sp = numValue;
        } else if (sigid === _ps_outTagId) {
          _pn_output = numValue;
        } else if (sigid === _ps_pTagId) {
          _pn_pTerm = numValue;
        } else if (sigid === _ps_iTagId) {
          _pn_iTerm = numValue;
        } else if (sigid === _ps_dTagId) {
          _pn_dTerm = numValue;
        } else if (sigid === _ps_errTagId) {
          _pn_error = numValue;
        } else if (sigid === _ps_modeTagId) {
          _pb_isAuto = (numValue > 0);
        }

        updateVisuals();
      };

      window.svgGetProperty = function(name) {
        if (name === 'pvVariableId') return _ps_pvTagId;
        if (name === 'spVariableId') return _ps_spTagId;
        if (name === 'outVariableId') return _ps_outTagId;
        if (name === 'pVariableId') return _ps_pTagId;
        if (name === 'iVariableId') return _ps_iTagId;
        if (name === 'dVariableId') return _ps_dTagId;
        if (name === 'errVariableId') return _ps_errTagId;
        if (name === 'modeVariableId') return _ps_modeTagId;
        if (name === 'modeCmdVariableId') return _ps_modeCmdTagId;
        if (name === '_ps_units') return _ps_units;
        if (name === '_pn_decimals') return _pn_decimals;
        return null;
      };

      window.svgSetProperty = function(name, value) {
        if (name === 'pvVariableId') {
          _ps_pvTagId = value;
        } else if (name === 'spVariableId') {
          _ps_spTagId = value;
        } else if (name === 'outVariableId') {
          _ps_outTagId = value;
        } else if (name === 'pVariableId') {
          _ps_pTagId = value;
        } else if (name === 'iVariableId') {
          _ps_iTagId = value;
        } else if (name === 'dVariableId') {
          _ps_dTagId = value;
        } else if (name === 'errVariableId') {
          _ps_errTagId = value;
        } else if (name === 'modeVariableId') {
          _ps_modeTagId = value;
        } else if (name === 'modeCmdVariableId') {
          _ps_modeCmdTagId = value;
        } else if (name === '_ps_units') {
          _ps_units = value;
          updateVisuals();
        } else if (name === '_pn_decimals') {
          _pn_decimals = parseInt(value);
          updateVisuals();
        }
      };

      // Initialize
      updateVisuals();
    })();

function putValue(id, value) {
  if (id === '_ps_pvTagId') {
    _ps_pvTagId = String(value) || "";
    update();
  } else if (id === '_ps_spTagId') {
    _ps_spTagId = String(value) || "";
    update();
  } else if (id === '_ps_outTagId') {
    _ps_outTagId = String(value) || "";
    update();
  } else if (id === '_ps_pTagId') {
    _ps_pTagId = String(value) || "";
    update();
  } else if (id === '_ps_iTagId') {
    _ps_iTagId = String(value) || "";
    update();
  } else if (id === '_ps_dTagId') {
    _ps_dTagId = String(value) || "";
    update();
  } else if (id === '_ps_errTagId') {
    _ps_errTagId = String(value) || "";
    update();
  } else if (id === '_ps_modeTagId') {
    _ps_modeTagId = String(value) || "";
    update();
  } else if (id === '_ps_modeCmdTagId') {
    _ps_modeCmdTagId = String(value) || "";
    update();
  } else if (id === '_pn_pv') {
    _pn_pv = Number(value) || 0;
    update();
  } else if (id === '_pn_sp') {
    _pn_sp = Number(value) || 0;
    update();
  } else if (id === '_pn_output') {
    _pn_output = Number(value) || 0;
    update();
  } else if (id === '_pn_pTerm') {
    _pn_pTerm = Number(value) || 0;
    update();
  } else if (id === '_pn_iTerm') {
    _pn_iTerm = Number(value) || 0;
    update();
  } else if (id === '_pn_dTerm') {
    _pn_dTerm = Number(value) || 0;
    update();
  } else if (id === '_pn_error') {
    _pn_error = Number(value) || 0;
    update();
  } else if (id === '_pb_isAuto') {
    _pb_isAuto = !!value;
    update();
  } else if (id === '_ps_units') {
    _ps_units = String(value) || "";
    update();
  } else if (id === '_pn_decimals') {
    _pn_decimals = Number(value) || 0;
    update();
  }
}

init();

]]></script>
</svg>
